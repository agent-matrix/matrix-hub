[supervisord]
nodaemon=true
user=app

[program:hub]
command=/app/.venv/bin/gunicorn src.app:app -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:443
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:gateway]
; Single-line bash -lc command (no heredocs or multiline continuation)
command=/bin/bash -lc 'cd /app/mcpgateway && . .venv/bin/activate && set -a; [ -f .env ] && . ./.env; set +a; [ -f ./mcp.db ] && echo "ℹ️ Removing stale SQLite ./mcp.db to enforce Postgres" && rm -f ./mcp.db || true; python -c "import os,sys; url=os.environ.get(\"DATABASE_URL\",\" \"); print(f\"ℹ️ Gateway DATABASE_URL = {url}\" if url else \"✖ ERROR: DATABASE_URL is not set for Gateway.\"); sys.exit(0 if url else 1)"; python -m mcpgateway.db && exec mcpgateway --host \"${HOST:-0.0.0.0}\" --port \"${PORT:-4444}\"'
directory=/app/mcpgateway
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
