{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://matrix-hub/schemas/agent.manifest.schema.json",
  "title": "Matrix Hub â€” Agent Manifest",
  "description": "Schema for an Agent published to Matrix Hub. Focuses on core identity, artifacts, capabilities, adapters, and optional MCP registration. Tight but permissive: unknown fields are allowed.",
  "type": "object",
  "additionalProperties": true,
  "required": [
    "schema_version",
    "type",
    "id",
    "name",
    "version",
    "description",
    "artifacts",
    "license"
  ],
  "properties": {
    "schema_version": {
      "type": "integer",
      "minimum": 1,
      "description": "Schema version number for this manifest format."
    },
    "type": {
      "const": "agent",
      "description": "Constant literal identifying this manifest as an Agent."
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9._-]*$",
      "description": "Stable identifier (scoped within type). Keep to lowercase letters, digits, dot, underscore, or dash."
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "description": "Human-friendly name for the agent."
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+(\\.[0-9]+)*([-.][0-9A-Za-z.]+)?$",
      "description": "Version string (SemVer-like preferred, but not strictly enforced)."
    },
    "summary": {
      "type": "string",
      "description": "Short, one-paragraph summary of what the agent does."
    },
    "description": {
      "type": "string",
      "minLength": 1,
      "description": "Long-form description of the agent, usage and behavior."
    },
    "license": {
      "type": "string",
      "description": "Project license identifier or text (SPDX string preferred)."
    },
    "homepage": {
      "type": "string",
      "format": "uri",
      "description": "Homepage URL for the agent/project."
    },
    "source_url": {
      "type": "string",
      "format": "uri",
      "description": "Source repository URL (e.g., GitHub)."
    },
    "capabilities": {
      "type": "array",
      "description": "List of capability tags that describe what the agent can do.",
      "items": { "type": "string", "minLength": 1 },
      "uniqueItems": true,
      "default": []
    },
    "tags": {
      "type": "array",
      "description": "Additional free-form tags.",
      "items": { "type": "string", "minLength": 1 },
      "uniqueItems": true,
      "default": []
    },
    "compatibility": {
      "type": "object",
      "description": "Compatibility hints indicating supported frameworks and providers.",
      "additionalProperties": true,
      "properties": {
        "frameworks": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "uniqueItems": true,
          "default": []
        },
        "providers": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "uniqueItems": true,
          "default": []
        },
        "runtime": {
          "type": "string",
          "description": "Optional runtime environment hint (e.g., python3.11)."
        },
        "min_version": {
          "type": "string",
          "description": "Optional minimum supported version of a primary dependency/framework."
        },
        "max_version": {
          "type": "string",
          "description": "Optional maximum supported version of a primary dependency/framework."
        }
      },
      "default": {}
    },
    "artifacts": {
      "type": "array",
      "minItems": 1,
      "description": "Installable artifacts for the agent (PyPI package, OCI image, git repo, or zip).",
      "items": { "$ref": "#/$defs/artifact" }
    },
    "endpoints": {
      "type": "object",
      "description": "Optional map of named endpoints (e.g., REST or MCP endpoints) the agent exposes.",
      "additionalProperties": true
    },
    "manifests": {
      "type": "object",
      "description": "Protocol-native manifest blocks (e.g., A2A). Keys are protocol names.",
      "additionalProperties": true,
      "properties": {
        "a2a": {
          "type": "object",
          "description": "A2A transport descriptor for registering/bridging the agent via A2A.",
          "required": ["endpoint_url"],
          "properties": {
            "version": { "type": "string", "default": "1.0" },
            "endpoint_url": { "type": "string", "format": "uri" },
            "agent_type": { "type": "string", "enum": ["jsonrpc", "custom"], "default": "jsonrpc" },
            "auth": {
              "type": "object",
              "properties": {
                "type": { "type": "string", "enum": ["none", "bearer", "api_key"], "default": "none" },
                "value": { "type": "string" }
              },
              "additionalProperties": true
            },
            "tags": { "type": "array", "items": { "type": "string" }, "default": [] },
            "server": { "type": "object", "additionalProperties": true }
          },
          "additionalProperties": true
        }
      }
    },
    "readme": {
      "type": "string",
      "description": "Optional README content inlined into the manifest (Markdown/plaintext)."
    },
    "readme_url": {
      "type": "string",
      "format": "uri",
      "description": "Optional URL to README content."
    },
    "examples": {
      "type": "array",
      "description": "Optional usage examples (free-form text).",
      "items": { "type": "string" },
      "default": []
    },
    "adapters": {
      "type": "array",
      "description": "Templates to write into a consumer project (e.g., LangGraph node, CrewAI tool).",
      "items": { "$ref": "#/$defs/adapter" },
      "default": []
    },
    "mcp_registration": {
      "type": "object",
      "description": "Instructions for registering tools/servers/resources with MCP Gateway.",
      "additionalProperties": true,
      "properties": {
        "tool": { "$ref": "#/$defs/mcpTool" },
        "server": { "$ref": "#/$defs/mcpServer" },
        "resources": {
          "type": "array",
          "items": { "type": "object", "additionalProperties": true },
          "description": "Optional list of MCP resources to register.",
          "default": []
        },
        "prompts": {
          "type": "array",
          "items": { "type": "object", "additionalProperties": true },
          "description": "Optional list of MCP prompts to register.",
          "default": []
        }
      }
    },
    "sig_uri": {
      "type": "string",
      "format": "uri",
      "description": "Optional signature metadata URI (e.g., for cosign/Sigstore)."
    },
    "sbom_uri": {
      "type": "string",
      "format": "uri",
      "description": "Optional SBOM metadata URI."
    }
  },
  "$defs": {
    "artifact": {
      "type": "object",
      "additionalProperties": true,
      "required": ["kind", "spec"],
      "properties": {
        "kind": {
          "type": "string",
          "enum": ["pypi", "oci", "git", "zip", "other"],
          "description": "Artifact type to install."
        },
        "spec": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": true,
          "description": "Artifact-specific spec. Common keys: package/version (pypi), image/tag/digest (oci), repo/ref (git), url/digest (zip)."
        },
        "sig_uri": { "type": "string", "format": "uri" },
        "sbom_uri": { "type": "string", "format": "uri" }
      }
    },
    "adapter": {
      "type": "object",
      "additionalProperties": true,
      "required": ["framework", "template_key"],
      "properties": {
        "framework": { "type": "string", "description": "Target integration (e.g., langgraph, crewai, watsonx_orchestrate)." },
        "template_key": { "type": "string", "description": "Template identifier known to the installer." },
        "min_version": { "type": "string", "description": "Minimum supported version of the target framework." },
        "path": { "type": "string", "description": "Optional target path hint for writing the adapter file(s)." },
        "params": { "type": "object", "additionalProperties": true, "description": "Template parameters (key/value)." }
      }
    },
    "mcpTool": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "integration_type", "request_type", "url", "input_schema"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "integration_type": { "type": "string", "enum": ["REST", "HTTP", "MCP"] },
        "request_type": { "type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"] },
        "url": { "type": "string", "format": "uri" },
        "input_schema": { "type": "object", "additionalProperties": true },
        "description": { "type": "string" },
        "annotations": { "type": "object", "additionalProperties": true }
      }
    },
    "mcpServer": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "transport", "url"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "transport": { "type": "string", "enum": ["WEBSOCKET", "HTTP", "STDIO"] },
        "url": { "type": "string", "format": "uri" },
        "description": { "type": "string" },
        "annotations": { "type": "object", "additionalProperties": true }
      }
    }
  }
}
